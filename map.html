---
layout: default
title: Fieldwork Map
---

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    /* 地図を包むコンテナ */
    .map-wrapper {
        position: relative;
        width: 100%;
        height: 700px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        background: #333; /* 読み込み中の背景色 */
    }

    #map { width: 100%; height: 100%; z-index: 1; }

    /* --------------------------------------------------
       【修正版】中央下・透過ガラスデザインのメモカード
       -------------------------------------------------- */
    #field-memo-area {
        position: absolute;
        
        /* ★位置：画面の下端ではなく「中央より少し下」に浮かせる */
        top: 60%; 
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9); /* 中央寄せ & 少し小さく待機 */
        
        width: 80%;            
        max-width: 380px;      
        max-height: 220px;
        
        z-index: 2000;
        
        /* ★デザイン：極限まで透けさせる + 強いぼかし */
        background: rgba(0, 0, 0, 0.5);       /* 黒を30%まで薄く */
        backdrop-filter: blur(10px);          /* すりガラス効果を強く */
        -webkit-backdrop-filter: blur(20px);
        
        color: #fff;
        padding: 20px;
        border-radius: 16px;                  /* 角をもっと丸く */
        border: 1px solid rgba(255, 255, 255, 0.15); /* 極細の白い枠 */
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); /* 影はやわらかく広げる */
        
        overflow-y: auto;
        display: none;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1); /* ヌルッと動く */
    }

    /* 表示時のクラス（JSでつけ外し） */
    #field-memo-area.active {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1); /* フワッと元のサイズへ */
    }

    /* テキストデザイン：細く、美しく */
    #field-memo-content {
        font-size: 13px;
        line-height: 1.8;
        font-family: 'Zen Kaku Gothic New', sans-serif;
        font-weight: 400;
        letter-spacing: 0.05em;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3); /* 文字を読みやすくする影 */
    }
    
    #field-memo-content b { 
        color: #81d4fa; 
        font-weight: 500;
    } 
    #field-memo-content a { color: #81d4fa; text-decoration: none; border-bottom: 1px dotted #81d4fa; }

    /* 閉じるボタン */
    .close-memo {
        position: absolute;
        top: 10px;
        right: 12px;
        width: 20px;
        height: 20px;
        line-height: 20px;
        text-align: center;
        color: rgba(255,255,255,0.5);
        cursor: pointer;
        font-size: 18px;
        border-radius: 50%;
        background: rgba(255,255,255,0.1);
        transition: 0.2s;
    }
    .close-memo:hover { 
        background: rgba(255,255,255,0.3); 
        color: #fff; 
    }

    /* --------------------------------------------------
       ポップアップ（画像カード）
       -------------------------------------------------- */
    .custom-popup { width: 260px; font-family: 'Zen Kaku Gothic New', sans-serif; }
    
    .custom-popup h3 { 
        margin: 0 0 8px 0; 
        font-size: 15px; 
        color: #00608d; 
        font-family: 'Shippori Mincho', serif; 
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }

    .popup-gallery {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        gap: 0;
        border-radius: 4px;
        margin-bottom: 8px;
    }
    
    .popup-gallery img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        flex-shrink: 0;
        scroll-snap-align: center;
    }

    /* ボタンデザイン：細い線でスタイリッシュに */
    .show-memo-btn {
        display: block;
        width: 100%;
        padding: 8px 0;
        margin-top: 5px;
        background: #fff;
        border: 1px solid #ddd;
        color: #555;
        text-align: center;
        border-radius: 20px; /* 丸ボタン */
        cursor: pointer;
        font-size: 11px;
        letter-spacing: 0.1em;
        transition: 0.2s;
    }
    .show-memo-btn:hover {
        border-color: #00608d;
        color: #00608d;
        background: #f9fbfd;
    }
</style>

<h1>Fieldwork Map: 水と歴史の足跡</h1>
<p>リサーチで訪れた場所と、そこで記録された視点。</p>

<div class="map-wrapper">
    <div id="map"></div>
    
    <!-- スタイリッシュ透過メモカード -->
    <div id="field-memo-area">
        <div class="close-memo" onclick="closeMemo()">×</div>
        <div id="field-memo-content">
            <!-- JSでここにテキストが入ります -->
        </div>
    </div>
</div>

<script>
    // 1. 地図設定
    var map = L.map('map').setView([35.038, 135.773], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    // 2. データ
    var locations = [
        {
            name: "下鴨神社・奈良の小川",
            lat: 35.037511, 
            lng: 135.772732,
            memo: "<b>【観察記録】</b><br>川の流れに反して、発生するアメンボの波紋。<br>目を凝らさないと見えない水面のアーティストの動きに気づけるか",
            images: ["./assets/image/nara-ogawa.png"]
        },
        {
            name: "下鴨神社・御手洗川",
            lat: 35.0298,
            lng: 135.7728,
            memo: "<b>【観察記録】</b><br>輪橋のところ。",
            images: ["./assets/image/mitarashi-gawa.png"]
        }
                {
            name: "下鴨神社・御手洗池",
            lat: 35.0298,
            lng: 135.7728,
            memo: "<b>【観察記録】</b><br>湧水。足つけ神事などが有名",
            images: ["./assets/image/mitarashi-ike.png"]
        }
            {
            name: "下鴨神社・泉川",
            lat: 35.0298,
            lng: 135.7728,
            memo: "<b>【観察記録】</b><br>湧水。足つけ神事などが有名",
            images: ["./assets/image/izumi-gawa.png"]
        }
    ];

    // メモエリア制御
    var memoArea = document.getElementById('field-memo-area');
    var memoContent = document.getElementById('field-memo-content');

    // 3. ピン配置
    locations.forEach(function(loc, index) {
        var popupContent = '<div class="custom-popup">';
        popupContent += '<h3>' + loc.name + '</h3>';
        
        if(loc.images && loc.images.length > 0) {
            popupContent += '<div class="popup-gallery">';
            loc.images.forEach(function(imgSrc) {
                if(imgSrc) popupContent += '<img src="' + imgSrc + '" alt="' + loc.name + '">';
            });
            popupContent += '</div>';
        }

        // コメントボタン
        if(loc.memo) {
            popupContent += '<button class="show-memo-btn" onclick="showMemo(' + index + ')">VIEW MEMO</button>';
        }

        popupContent += '</div>';

        var marker = L.marker([loc.lat, loc.lng]).addTo(map);
        marker.bindPopup(popupContent, { maxWidth: 280 });
        
        marker.on('popupclose', function() {
            closeMemo();
        });
    });

    // 表示関数
    window.showMemo = function(index) {
        var loc = locations[index];
        if(loc && loc.memo) {
            memoContent.innerHTML = loc.memo;
            memoArea.style.display = 'block';
            // 少し遅らせてクラスを追加（アニメーション用）
            setTimeout(function() {
                memoArea.classList.add('active');
            }, 10);
        }
    };

    // 非表示関数
    window.closeMemo = function() {
        memoArea.classList.remove('active');
        // アニメーションが終わるのを待って消す
        setTimeout(function() {
            memoArea.style.display = 'none';
        }, 300);
    };

    map.on('click', function() {
        closeMemo();
    });
</script>


